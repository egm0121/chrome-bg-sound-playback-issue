<!DOCTYPE html>
<html>
  <head>
    <title>Sample Application</title>
  </head>
  <body>
    <h2>Sample Application</h2>
    <textarea>1. focus me once to activate page</textarea>
    2. open another tab and go to: 'https://egm0121.github.io/'
    4. Open the DevTools and paste the following in the console : 
    <pre>(new BroadcastChannel("call-manager-demo")).postMessage('play-sound')</pre>
    
    <p>
      <b>Expected:</b> sound starts to play immediately even in tab is not visible
    </p>
    <p>
      <b>Actual:</b> sound does not play until tab is selected and foregrounded
    </p>
    <div id="socket_log"></div>
    <script>
    // Connection to a demo broadcast channel
    const bc = new BroadcastChannel("call-manager-demo");
    bc.onmessage = (event) => {
      console.log('got event', event.data);
      if(event.data === 'play-sound') {
        const demoSoundPlayer = new Audio();
        demoSoundPlayer.src = 'https://download.samplelib.com/mp3/sample-3s.mp3';
        demoSoundPlayer.play();
      }
    };
    
     let socket = new WebSocket('wss://ws.postman-echo.com/raw');
     let socketStatus = document.querySelector('#socket_log');
      // Handle any errors that occur.
      socket.onerror = function(error) {
        console.log('WebSocket Error: ' + error);
         socketStatus.innerHTML += 'Error: ' + error.url;
      };


      // Show a connected message when the WebSocket is opened.
      socket.onopen = function(event) {
        socketStatus.innerHTML += 'Connected to: ' + event.currentTarget.url;
      };
    </script>
  </body>
</html>
